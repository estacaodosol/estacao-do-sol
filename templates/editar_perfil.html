{% extends 'base.html' %}

{% block titulo %}Editar Perfil{% endblock %}

{% block conteudo %}
<div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
  <div class="card shadow-lg p-4" style="max-width: 500px; width: 100%;">
    <h3 class="text-center mb-4 text-primary">
      <i class="fas fa-user-cog"></i> Editar Perfil
    </h3>

    <!-- Mensagens flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" class="needs-validation" novalidate>
      <!-- Nome -->
      <div class="mb-3">
        <label for="nome" class="form-label">Nome Completo</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-user"></i></span>
          <input type="text" class="form-control" id="nome" name="nome" value="{{ morador.nome }}" required>
        </div>
      </div>

      <!-- Telefone -->
      <div class="mb-3">
        <label for="telefone" class="form-label">Telefone / WhatsApp</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-phone"></i></span>
          <input type="tel" class="form-control" id="telefone" name="telefone" value="{{ morador.telefone or '' }}">
        </div>
      </div>

      <!-- Bloco e Número -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="bloco" class="form-label">Bloco</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-building"></i></span>
            <select id="bloco" name="bloco" class="form-select" required>
              {% for b in range(1, 11) %}
                <option value="{{ b }}" {% if apartamento.bloco == b|string %}selected{% endif %}>{{ b }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label for="numero" class="form-label">Apartamento</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-door-closed"></i></span>
            <select id="numero" name="numero" class="form-select" required>
              {% for andar in range(1, 8) %}
                {% for apt in range(1, 5) %}
                  {% set num_apt = (andar|string) + (apt|string) %}
                  <option value="{{ num_apt }}" {% if apartamento.numero == num_apt %}selected{% endif %}>
                    {{ num_apt }}
                  </option>
                {% endfor %}
              {% endfor %}
            </select>
          </div>
        </div>
      </div>

      <!-- Email -->
      <div class="mb-3">
        <label for="email" class="form-label">E-mail</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-envelope"></i></span>
          <input type="email" class="form-control" id="email" name="email" value="{{ usuario.email }}" required>
        </div>
      </div>

      <!-- Senha -->
      <div class="mb-3">
        <label for="senha" class="form-label">Nova Senha (opcional)</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-lock"></i></span>
          <input type="password" class="form-control" id="senha" name="senha" placeholder="Deixe em branco para manter a atual">
        </div>
      </div>

      <button type="submit" class="btn btn-success w-100 mb-3">
        <i class="fas fa-save"></i> Salvar Alterações
      </button>

      <a href="{{ url_for('dashboard_morador') }}" class="btn btn-outline-secondary w-100">
        <i class="fas fa-arrow-left"></i> Voltar
      </a>
    </form>
  </div>
</div>

<script>
  // Validação do Bootstrap
  (function () {
    'use strict'
    var forms = document.querySelectorAll('.needs-validation')
    Array.prototype.slice.call(forms).forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }
        form.classList.add('was-validated')
      }, false)
    })
  })()
</script>
{% endblock %}
